<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.toughguy.transactionSystem.model.content.vo.MemberBasicInfo">
	
	<!-- 存储基本资料 -->
	<insert id="saveBasicInfo1" parameterType="MemberBasicInfo" useGeneratedKeys="true" keyProperty="memberId">
		insert into 
		transaction_member(open_id,member_tel,member_pwd,member_date,member_name,member_card,member_integral,member_rank,member_online_times)
		values(#{openId},#{memberTel},#{memberPwd},#{memberDate},#{memberName},#{memberCard},#{memberIntegral},#{memberRank},#{memberOnlineTimes});
	</insert>
	<insert id="saveBasicInfo2" parameterType="MemberBasicInfo">
		insert into 
		transaction_enterprise(member_id,enterprise_name,enterprise_card_type,enterprise_card_id)
		values(#{memberId},#{enterpriseName},#{enterpriseCardType},#{enterpriseCardId});
	</insert>
	
	<!-- 检查会员是否存在 -->
	<select id="loginCheck" parameterType="TransactionMember" resultType="TransactionMember">
		select * from transaction_member 
		where member_tel=#{memberTel} and member_pwd=#{memberPwd};
	</select>
	
	<!-- 检查openId是否注册 -->
	<select id="checkOpenId" parameterType="TransactionMember" resultType="TransactionMember">
		select * from transaction_member 
		where open_id=#{openId}
	</select>
	
	<!-- 更改密码 -->
	<update id="updatePassword">
		update transaction_member set member_pwd=#{memberPwd} 
		where member_id= #{memberId};
	</update>
	
	<!-- 解除绑定 -->
	<update id="updateUser">
		update transaction_member 
		set member_tel=#{memberTel},open_id=#{openId}
		where member_id= #{memberId};
	</update>
	
	<select id="memberInfo" resultType="TransactionMember">
		select 
			member_id, 
			member_name,
			member_card,
			member_tel,
			member_rank,
			member_online_times,
			member_date
		from transaction_member
		<!-- limit #{offset} , #{limit} -->

	</select>
	
	<select id="enterpriseInfo" resultType="MemberBasicInfo">
		select 
		member.member_id,
		enterprise.enterprise_name,
		member.member_tel,
		member.member_rank,
		member.member_online_times,
		member.member_date
		from transaction_member member
		join transaction_enterprise enterprise
		on member.member_id = enterprise.member_id
	<!-- 	limit #{offset} , #{limit}  -->
	</select>
</mapper>